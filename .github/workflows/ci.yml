name: CI
on:
  push:
    branches: [ main ]
    tags: [ v* ]
  repository_dispatch:
    types: [ new-jx ]
  workflow_dispatch:
jobs:
  build-ubuntu:
    if: ${{ !startsWith(github.ref, 'refs/tags/') }}
    uses: jafl/jx_application_framework/.github/workflows/app-build-ubuntu.yml@main
    secrets:
      sonar-token: ${{ secrets.SONAR_TOKEN }}

  build-ubuntu-release:
    name: Build & Package Ubuntu
    if: ${{ startsWith(github.ref, 'refs/tags/') }}
    uses: jafl/jx_application_framework/.github/workflows/app-build-ubuntu-release.yml@main
    with:
      pkg-name: nps-ssh-askpass

  build-fedora:
    name: Build & Package Fedora
    uses: jafl/jx_application_framework/.github/workflows/app-build-fedora.yml@main
    with:
      pkg-name: nps-ssh-askpass

  build-macos:
    name: Build & Package MacOS
    uses: jafl/jx_application_framework/.github/workflows/app-build-macos.yml@main
    with:
      pkg-name: nps-ssh-askpass

  release:
    name: Upload releases
    needs: [ build-ubuntu-release, build-fedora, build-macos ]
    if: ${{ startsWith(github.ref, 'refs/tags/') }}
    uses: jafl/jx_application_framework/.github/workflows/app-set-sourceforge-defaults.yml@main
    with:
      pkg-name: nps-ssh-askpass
      forge-name: nps-ssh-askpass
    secrets:
      api-key: ${{ secrets.SOURCEFORGE_API_KEY }}
      ssh-key: ${{ secrets.SOURCEFORGE_SSH_KEY }}
